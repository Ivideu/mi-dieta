<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes Helper - Ivideu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { background: white; border-radius: 1rem; shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        input:focus { border-color: #2563eb; outline: none; ring: 2px #bfdbfe; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 font-sans text-slate-900">

    <div class="max-w-md mx-auto space-y-4">
        <header class="text-center py-4">
            <h1 class="text-3xl font-extrabold text-blue-600">DiabetCalc AI</h1>
            <p class="text-slate-500 text-sm">Cálculo basado en Reglas 1800 y 500</p>
        </header>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Configuración Personal</h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-semibold mb-1">DTI (Insulina Total/Día)</label>
                    <input type="number" id="dti" value="40" class="w-full border border-slate-300 p-2 rounded-lg bg-slate-50">
                </div>
                <div>
                    <label class="block text-xs font-semibold mb-1">Objetivo (mg/dL)</label>
                    <input type="number" id="objetivo" value="120" class="w-full border border-slate-300 p-2 rounded-lg bg-slate-50">
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-blue-500">
            <h2 class="text-lg font-bold mb-4">Datos Actuales</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Glucemia Actual (mg/dL)</label>
                    <input type="number" id="glucemia" placeholder="Ej: 160" class="w-full text-lg border-slate-300 p-3 rounded-xl border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1 text-blue-700">Gramos de Hidratos (HC)</label>
                    <input type="number" id="gramos" placeholder="Ej: 50" class="w-full text-lg border-blue-200 p-3 rounded-xl border bg-blue-50">
                    <p class="text-[10px] text-slate-400 mt-1">* 10g de HC = 1 Ración</p>
                </div>

                <button onclick="calcularDosis()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg active:scale-95">
                    CALCULAR DOSIS
                </button>
            </div>
        </div>

        <div id="resultado" class="hidden transform transition-all">
            <div class="bg-white p-6 rounded-2xl shadow-xl border-2 border-green-500 relative overflow-hidden">
                <div id="alerta-hipo" class="hidden bg-red-100 text-red-700 p-3 rounded-lg mb-4 text-sm font-bold">
                    ⚠️ ¡GLUCEMIA BAJA! Aplica regla del 15.
                </div>

                <div class="flex justify-between items-end mb-4">
                    <div>
                        <p class="text-slate-500 text-sm">Dosis Total Recomendada</p>
                        <h2 id="total-ui" class="text-5xl font-black text-green-600">0.0 <span class="text-xl">UI</span></h2>
                    </div>
                    <div class="text-right">
                        <p id="txt-raciones" class="text-lg font-bold text-slate-700">0 Raciones</p>
                    </div>
                </div>

                <div class="border-t pt-4 space-y-2 text-sm text-slate-600">
                    <div class="flex justify-between">
                        <span>Bolo por Comida (Ratio):</span>
                        <span id="ui-comida" class="font-mono font-bold">0.0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Bolo Corrector (FSI):</span>
                        <span id="ui-correccion" class="font-mono font-bold">0.0</span>
                    </div>
                </div>
            </div>
        </div>

        <p class="text-[10px] text-slate-400 text-center px-4">
            ADVERTENCIA: Esta app es un prototipo. Los cálculos deben ser supervisados por un médico. No tomes decisiones médicas basadas únicamente en esta herramienta.
        </p>
    </div>

    <script>
        function calcularDosis() {
            // Captura de datos
            const dti = parseFloat(document.getElementById('dti').value);
            const objetivo = parseFloat(document.getElementById('objetivo').value);
            const glucemia = parseFloat(document.getElementById('glucemia').value);
            const gramos = parseFloat(document.getElementById('gramos').value);

            if (!dti || !glucemia || isNaN(gramos)) {
                alert("Por favor, introduce los datos necesarios.");
                return;
            }

            // --- FÓRMULAS DEL PDF ---
            
            // 1. Convertir gramos a raciones (1 Ración = 10g)
            const raciones = gramos / 10;

            // 2. Factor de Sensibilidad (FSI) - Regla 1800
            // Cuánto baja 1 unidad de insulina la glucosa
            const fsi = 1800 / dti;

            // 3. Ratio Insulina/Ración - Regla 500
            // Cuántas unidades se necesitan por cada ración (10g)
            // (10 / (500 / DTI))
            const uiPorRacion = 10 / (500 / dti);

            // 4. Cálculos de Bolo
            const boloComida = raciones * uiPorRacion;
            
            let boloCorrector = 0;
            if (glucemia > objetivo) {
                boloCorrector = (glucemia - objetivo) / fsi;
            }

            const total = boloComida + boloCorrector;

            // --- MOSTRAR RESULTADOS ---
            document.getElementById('resultado').classList.remove('hidden');
            document.getElementById('total-ui').innerHTML = `${total.toFixed(1)} <span class="text-xl">UI</span>`;
            document.getElementById('txt-raciones').innerText = `${raciones.toFixed(1)} Raciones`;
            document.getElementById('ui-comida').innerText = `${boloComida.toFixed(1)} UI`;
            document.getElementById('ui-correccion').innerText = `${boloCorrector.toFixed(1)} UI`;

            // Alerta de Hipoglucemia
            const alertaHipo = document.getElementById('alerta-hipo');
            if (glucemia < 70) {
                alertaHipo.classList.remove('hidden');
            } else {
                alertaHipo.classList.add('hidden');
            }

            // Límite de seguridad para evitar errores de escritura
            if (total > 15) {
                alert("⚠️ AVISO: El cálculo supera las 15 unidades. Revisa si has puesto bien los gramos de Hidratos de Carbono.");
            }
        }
    </script>
</body>
</html>
