<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diabetes AI - Segmentaci√≥n Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #0f172a; }
        .food-badge { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="p-4 pb-32">

    <div class="max-w-md mx-auto space-y-6">
        <header class="text-center py-2">
            <h1 class="text-2xl font-black text-blue-500 italic">GLUCO<span class="text-white">SEGMENT</span></h1>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Ratio: 7.5 | Sin errores de IA</p>
        </header>

        <div class="bg-slate-900 p-4 rounded-[2rem] border border-slate-800 shadow-xl">
            <p class="text-[10px] font-black text-slate-500 uppercase mb-3 text-center">Toca para segmentar el plato</p>
            
            <div class="grid grid-cols-3 gap-2" id="grid-alimentos">
                </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-[2.5rem] border border-slate-700">
            <h2 class="text-xs font-bold text-blue-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                üç¥ Plato Actual
            </h2>
            <div id="lista-segmentada" class="space-y-2 min-h-[100px]">
                <p class="text-slate-500 text-sm italic text-center py-6">Selecciona alimentos arriba...</p>
            </div>
            
            <div class="mt-6 pt-4 border-t border-slate-700 flex justify-between items-end">
                <div>
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Total Hidratos</p>
                    <p id="total-hc" class="text-5xl font-black text-white">0<span class="text-xl text-slate-600 ml-1">g</span></p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-slate-500 font-bold uppercase text-blue-400">Raciones</p>
                    <p id="total-rac" class="text-2xl font-black text-white">0.0</p>
                </div>
            </div>
        </div>

        <div class="bg-blue-600 p-6 rounded-[2.5rem] shadow-2xl">
            <div class="flex gap-4">
                <div class="flex-1">
                    <input type="number" id="glucemia" placeholder="mg/dL" class="w-full bg-blue-700 border-none rounded-2xl p-4 text-2xl font-bold text-white placeholder-blue-300 outline-none">
                </div>
                <button onclick="calcularDosis()" class="bg-white text-blue-600 px-8 rounded-2xl font-black text-sm uppercase tracking-tighter">Calcular</button>
            </div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-slate-950/98 flex items-center justify-center z-50 p-6 backdrop-blur-sm">
        <div class="bg-slate-900 border border-slate-800 w-full max-w-sm rounded-[3rem] p-10 text-center shadow-2xl">
            <p class="text-slate-500 text-[10px] font-black uppercase mb-4 tracking-widest">Insulina Sugerida (Ratio 7.5)</p>
            <div class="py-10 bg-slate-800/50 rounded-[2.5rem] border border-slate-700 mb-8">
                <span id="res-total" class="text-9xl font-black text-white leading-none">0.0</span>
                <span class="block text-blue-500 font-bold text-2xl mt-4">UNIDADES</span>
            </div>
            <button onclick="document.getElementById('modal').classList.add('hidden')" class="w-full bg-blue-600 py-4 rounded-2xl font-black text-white">ENTENDIDO</button>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN DE RATIO (Ajustado a 7.5 como pediste)
        const RATIO = 7.5; 
        const FSI = 33.3; 
        const OBJETIVO = 120;

        // --- C√ìMO AMPLIAR LOS ALIMENTOS ---
        // Solo tienes que a√±adir una l√≠nea nueva aqu√≠ abajo siguiendo este formato:
        // "nombre": { esp: "Nombre en pantalla", hc: gramos, icon: "icono" }
        const BASE_DATOS = {
            "espagueti": { esp: "Espaguetis", hc: 55, icon: "üçù" },
            "pizza": { esp: "Pizza", hc: 65, icon: "üçï" },
            "arroz": { esp: "Arroz Blanco", hc: 50, icon: "üçö" },
            "patatas": { esp: "Patatas Fritas", hc: 45, icon: "üçü" },
            "pan": { esp: "Pan / Rebanada", hc: 20, icon: "üçû" },
            "lentejas": { esp: "Lentejas", hc: 30, icon: "ü•ò" },
            "carne": { esp: "Lomo / Carne", hc: 0, icon: "ü•©" },
            "fruta": { esp: "Fruta", hc: 15, icon: "üçé" },
            "dulce": { esp: "Postre / Dulce", hc: 40, icon: "üç∞" },
            "ensalada": { esp: "Verdura / Ensalada", hc: 5, icon: "ü•ó" }
        };

        let platoActual = [];

        // Generar botones de alimentos autom√°ticamente
        function cargarBotones() {
            const grid = document.getElementById('grid-alimentos');
            for (let id in BASE_DATOS) {
                const item = BASE_DATOS[id];
                grid.innerHTML += `
                    <button onclick="a√±adirAlPlato('${id}')" class="bg-slate-800 p-3 rounded-2xl flex flex-col items-center border border-slate-700 active:bg-blue-600 transition-colors">
                        <span class="text-2xl mb-1">${item.icon}</span>
                        <span class="text-[9px] font-black uppercase text-slate-300">${item.esp}</span>
                    </button>
                `;
            }
        }

        function a√±adirAlPlato(id) {
            const alimento = BASE_DATOS[id];
            platoActual.push({ ...alimento, uniqueId: Date.now() });
            actualizarInterfaz();
        }

        function quitarDelPlato(uId) {
            platoActual = platoActual.filter(i => i.uniqueId !== uId);
            actualizarInterfaz();
        }

        function actualizarInterfaz() {
            const lista = document.getElementById('lista-segmentada');
            const totalUI = document.getElementById('total-hc');
            const racUI = document.getElementById('total-rac');
            
            if (platoActual.length === 0) {
                lista.innerHTML = `<p class="text-slate-500 text-sm italic text-center py-6">Selecciona alimentos arriba...</p>`;
                totalUI.innerText = "0g";
                racUI.innerText = "0.0";
                return;
            }

            let totalHC = 0;
            lista.innerHTML = "";

            platoActual.forEach(item => {
                totalHC += item.hc;
                lista.innerHTML += `
                    <div class="food-badge flex justify-between items-center bg-slate-700/40 p-3 rounded-xl border border-slate-600">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">${item.icon}</span>
                            <span class="text-xs font-bold text-white uppercase">${item.esp}</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="text-sm font-black text-blue-400">${item.hc}g</span>
                            <button onclick="quitarDelPlato(${item.uniqueId})" class="text-slate-500 hover:text-white font-bold">‚úï</button>
                        </div>
                    </div>
                `;
            });

            totalUI.innerHTML = `${totalHC}<span class="text-xl text-slate-600 ml-1">g</span>`;
            racUI.innerText = (totalHC / 10).toFixed(1);
            window.lastTotal = totalHC;
        }

        function calcularDosis() {
            const glu = parseFloat(document.getElementById('glucemia').value);
            if (!glu) return alert("Introduce tu glucemia actual");

            const hc = window.lastTotal || 0;
            const doseComida = hc / RATIO;
            const doseCorr = glu > OBJETIVO ? (glu - OBJETIVO) / FSI : 0;
            
            let total = Math.round((doseComida + doseCorr) * 2) / 2;

            document.getElementById('res-total').innerText = total.toFixed(1);
            document.getElementById('modal').classList.remove('hidden');
        }

        cargarBotones();
    </script>
</body>
</html>
